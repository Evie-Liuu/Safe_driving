# å¤šéŠæˆ²æ¨¡çµ„æ¶æ§‹è¨­è¨ˆ

## æ¦‚è¿°

å°‡å°ˆæ¡ˆé‡æ§‹ç‚ºæ”¯æ´å¤šéŠæˆ²æ¨¡çµ„çš„æ¶æ§‹ï¼Œæ–°å¢ã€Œè¡Œç‚ºç³¾å¯ŸéšŠã€éŠæˆ²ã€‚

---

## ä¸€ã€æ•´é«”æ¶æ§‹

### è³‡æ–™å¤¾çµæ§‹

```
src/
â”œâ”€â”€ App.tsx                    # è·¯ç”±å…¥å£
â”œâ”€â”€ main.tsx
â”œâ”€â”€ components/
â”‚   â””â”€â”€ MainMenu.tsx           # ä¸»é¸å–®ç•«é¢
â”œâ”€â”€ games/                     # éŠæˆ²æ¨¡çµ„è³‡æ–™å¤¾
â”‚   â”œâ”€â”€ index.ts               # éŠæˆ²è¨»å†Šä¸­å¿ƒ
â”‚   â”œâ”€â”€ types.ts               # å…±ç”¨éŠæˆ²é¡å‹å®šç¾©
â”‚   â”œâ”€â”€ safe-driving/          # ç¾æœ‰éŠæˆ²ç§»å…¥
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ SafeDrivingGame.tsx
â”‚   â”‚   â””â”€â”€ ... (ç¾æœ‰æª”æ¡ˆ)
â”‚   â””â”€â”€ behavior-patrol/       # æ–°éŠæˆ²ï¼šè¡Œç‚ºç³¾å¯ŸéšŠ
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ BehaviorPatrolGame.tsx
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ hooks/
â”‚       â”œâ”€â”€ data/
â”‚       â””â”€â”€ types.ts
â””â”€â”€ game/                      # å…±ç”¨éŠæˆ²ç³»çµ±ï¼ˆä¿ç•™ï¼‰
    â”œâ”€â”€ animations/
    â”œâ”€â”€ models/
    â””â”€â”€ utils/
```

---

## äºŒã€éŠæˆ²è¨»å†Šç³»çµ±

### é¡å‹å®šç¾© (`games/types.ts`)

```typescript
export interface GameConfig {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  name: string;                  // é¡¯ç¤ºåç¨±
  description: string;           // éŠæˆ²èªªæ˜
  thumbnail?: string;            // ç¸®åœ–è·¯å¾‘
  component: React.ComponentType<{ onExit: () => void }>;
  difficulty?: 'easy' | 'medium' | 'hard';
}
```

### è¨»å†Šä¸­å¿ƒ (`games/index.ts`)

```typescript
import { SafeDrivingGame } from './safe-driving';
import { BehaviorPatrolGame } from './behavior-patrol';

export const gameRegistry: GameConfig[] = [
  {
    id: 'safe-driving',
    name: 'å®‰å…¨é§•é§›è¨“ç·´',
    description: 'åœ¨ 3D å ´æ™¯ä¸­é§•é§›ï¼Œè­˜åˆ¥é“è·¯ä¸Šçš„å±éšªå› å­',
    component: SafeDrivingGame,
  },
  {
    id: 'behavior-patrol',
    name: 'è¡Œç‚ºç³¾å¯ŸéšŠ',
    description: 'è§€å¯Ÿå ´æ™¯ï¼Œæ‰¾å‡º 5 å€‹å±éšªå› å­ä¸¦å›ç­”å•é¡Œ',
    component: BehaviorPatrolGame,
  },
];
```

---

## ä¸‰ã€è¡Œç‚ºç³¾å¯ŸéšŠ - éŠæˆ²è¦æ ¼

### åŸºæœ¬è¦å‰‡

- æ¯å›åˆ 60 ç§’
- æ‰¾å‡º 5 å€‹å±éšªå› å­
- 3 æ¬¡éŒ¯èª¤æ©Ÿæœƒï¼ˆç”Ÿå‘½æ¢ï¼‰
- é»æ“Šæ­£ç¢º â†’ æš«åœ â†’ å•ç­” Q1+Q2 â†’ å›é¥‹ â†’ é»æ“Šç¹¼çºŒ

### éŠæˆ²ç‹€æ…‹

```typescript
export interface DangerFactor {
  id: string;
  name: string;
  position: [number, number, number];
  model: string;
  behaviors: DangerBehavior[];
  questions: {
    q1: QuizQuestion;
    q2: QuizQuestion;
  };
  feedback: string;
  found: boolean;
}

export interface DangerBehavior {
  type: 'movement' | 'animation' | 'loop';
  path?: [number, number, number][];
  speed?: number;
  loop?: boolean;
  animation?: string;
  animationLoop?: boolean;
}

export interface QuizQuestion {
  question: string;
  options: string[];
  correctIndex: number;
}

export interface GameProgress {
  timeRemaining: number;
  lives: number;
  foundCount: number;
  totalDangers: number;
  score: number;
  status: 'playing' | 'paused' | 'quiz' | 'feedback' | 'won' | 'lost';
}
```

### ç‹€æ…‹æ©Ÿæµç¨‹

```
[é–‹å§‹] â†’ playing â†’ é»æ“Šæ­£ç¢º â†’ quiz (æš«åœ)
            â”‚              â”‚
            â”‚              â†“
            â”‚         å›ç­” Q1+Q2
            â”‚              â”‚
            â”‚              â†“
            â”‚         feedback (é¡¯ç¤ºå›é¥‹)
            â”‚              â”‚
            â”‚              â†“
            â”‚         é»æ“Šç¹¼çºŒ â†’ playing
            â”‚
            â”œâ”€â”€ é»æ“ŠéŒ¯èª¤ â†’ lives - 1
            â”‚       â”‚
            â”‚       â””â”€â”€ lives = 0 â†’ [lost]
            â”‚
            â”œâ”€â”€ æ‰¾åˆ°å…¨éƒ¨ 5 å€‹ â†’ [won]
            â”‚
            â””â”€â”€ æ™‚é–“åˆ° â†’ [lost]
```

---

## å››ã€è¡Œç‚ºç³¾å¯ŸéšŠ - æª”æ¡ˆçµæ§‹

```
src/games/behavior-patrol/
â”œâ”€â”€ index.ts                     # æ¨¡çµ„å°å‡º
â”œâ”€â”€ BehaviorPatrolGame.tsx       # éŠæˆ²ä¸»çµ„ä»¶
â”œâ”€â”€ types.ts                     # é¡å‹å®šç¾©
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PatrolScene.tsx          # 3D å ´æ™¯ï¼ˆå›ºå®šè¦–è§’ï¼‰
â”‚   â”œâ”€â”€ DangerObject.tsx         # å¯é»æ“Šçš„å±éšªå› å­ç‰©ä»¶
â”‚   â”œâ”€â”€ GameHUD.tsx              # é ‚éƒ¨ HUDï¼ˆç”Ÿå‘½ã€æ™‚é–“ã€é€²åº¦ï¼‰
â”‚   â”œâ”€â”€ QuizModal.tsx            # å•ç­”å½ˆçª—
â”‚   â”œâ”€â”€ FeedbackPanel.tsx        # å›é¥‹èªªæ˜é¢æ¿
â”‚   â”œâ”€â”€ ResultScreen.tsx         # éŠæˆ²çµæŸç•«é¢
â”‚   â””â”€â”€ CountdownTimer.tsx       # å€’æ•¸è¨ˆæ™‚å™¨
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useGameState.ts          # éŠæˆ²ç‹€æ…‹ç®¡ç† Hook
â”‚   â””â”€â”€ useTimer.ts              # è¨ˆæ™‚å™¨ Hookï¼ˆå¯æš«åœï¼‰
â”‚
â””â”€â”€ data/
    â””â”€â”€ PatrolScenario_1.ts      # å ´æ™¯è³‡æ–™
```

---

## äº”ã€UI è¨­è¨ˆ

### éŠæˆ² HUD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â¤ï¸â¤ï¸â¤ï¸                                    â±ï¸ 00:45      â”‚
â”‚  (ç”Ÿå‘½æ¢)                                   (å€’æ•¸è¨ˆæ™‚)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚                    3D å ´æ™¯ç•«é¢                           â”‚
â”‚              (å¯é»æ“Šçš„å±éšªå› å­ç‰©ä»¶)                       â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    é€²åº¦: 2/5 å·²æ‰¾åˆ°                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å•ç­”å½ˆçª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ” ç™¼ç¾å±éšªï¼šè¡Œäººé—¯çº¢ç¯                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Q1: é€™å€‹è¡Œç‚ºç‚ºä»€éº¼å±éšªï¼Ÿ                                â”‚
â”‚    â—‹ A. æœƒé€ æˆäº¤é€šå µå¡                                  â”‚
â”‚    â— B. å¯èƒ½è¢«è»Šè¼›æ’åˆ°                                  â”‚
â”‚    â—‹ C. æœƒè¢«é–‹ç½°å–®                                      â”‚
â”‚    â—‹ D. æ²’æœ‰å±éšª                                        â”‚
â”‚                                                         â”‚
â”‚  Q2: é§•é§›æ‡‰è©²å¦‚ä½•æ‡‰å°ï¼Ÿ                                  â”‚
â”‚    â—‹ A. åŠ é€Ÿé€šé                                        â”‚
â”‚    â—‹ B. æŒ‰å–‡å­è­¦å‘Š                                      â”‚
â”‚    â— C. æ¸›é€Ÿä¸¦æ³¨æ„è¡Œäººå‹•å‘                              â”‚
â”‚    â—‹ D. ä¸éœ€è¦ç†æœƒ                                      â”‚
â”‚                                                         â”‚
â”‚                   [ ç¢ºèªé€å‡º ]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›é¥‹é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     âœ… ç­”å°äº†ï¼                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Q1: âœ… æ­£ç¢º                                             â”‚
â”‚  Q2: âŒ éŒ¯èª¤                                             â”‚
â”‚                                                         â”‚
â”‚  æ­£ç¢ºç­”æ¡ˆï¼š                                              â”‚
â”‚  Q2 æ‡‰é¸ C. æ¸›é€Ÿä¸¦æ³¨æ„è¡Œäººå‹•å‘                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ’¡ èªªæ˜ï¼š                                               â”‚
â”‚  è¡Œäººé—¯çº¢ç¯æ™‚ï¼Œé§•é§›æ‡‰ä¿æŒè­¦è¦ºï¼Œæ¸›é€Ÿè§€å¯Ÿ                    â”‚
â”‚  è¡Œäººå‹•å‘ï¼Œå¿…è¦æ™‚åœè»Šç¦®è®“ï¼Œé¿å…ç™¼ç”Ÿäº‹æ•…ã€‚                  â”‚
â”‚                                                         â”‚
â”‚                   [ ç¹¼çºŒéŠæˆ² ]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€å ´æ™¯è³‡æ–™çµæ§‹

```typescript
export const patrolScenario1 = {
  id: 'scenario-1',
  name: 'åå­—è·¯å£å ´æ™¯',
  description: 'è§€å¯Ÿç¹å¿™çš„åå­—è·¯å£ï¼Œæ‰¾å‡ºå±éšªè¡Œç‚º',
  timeLimit: 60,
  maxLives: 3,

  scene: {
    environment: 'city-intersection',
    cameraPosition: [0, 15, 30],
    cameraLookAt: [0, 0, 0],
  },

  dangers: [
    {
      id: 'danger-1',
      name: 'é—¯çº¢ç¯è¡Œäºº',
      position: [5, 0, 3],
      model: '/models/pedestrian.glb',
      behaviors: [
        { type: 'animation', animation: 'walking', animationLoop: true },
        { type: 'movement', path: [[5, 0, 3], [5, 0, -3]], speed: 1.5, loop: false },
      ],
      questions: {
        q1: {
          question: 'é€™å€‹è¡Œç‚ºç‚ºä»€éº¼å±éšªï¼Ÿ',
          options: ['æœƒé€ æˆäº¤é€šå µå¡', 'å¯èƒ½è¢«è»Šè¼›æ’åˆ°', 'æœƒè¢«é–‹ç½°å–®', 'æ²’æœ‰å±éšª'],
          correctIndex: 1,
        },
        q2: {
          question: 'é§•é§›æ‡‰è©²å¦‚ä½•æ‡‰å°ï¼Ÿ',
          options: ['åŠ é€Ÿé€šé', 'æŒ‰å–‡å­è­¦å‘Š', 'æ¸›é€Ÿä¸¦æ³¨æ„è¡Œäººå‹•å‘', 'ä¸éœ€è¦ç†æœƒ'],
          correctIndex: 2,
        },
      },
      feedback: 'è¡Œäººé—¯çº¢ç¯æ™‚ï¼Œé§•é§›æ‡‰ä¿æŒè­¦è¦ºï¼Œæ¸›é€Ÿè§€å¯Ÿè¡Œäººå‹•å‘ï¼Œå¿…è¦æ™‚åœè»Šç¦®è®“ã€‚',
    },
    // ... å…¶ä»–å±éšªå› å­
  ],

  safeObjects: [
    {
      id: 'safe-1',
      name: 'æ­£å¸¸è¡Œé§›è»Šè¼›',
      position: [-5, 0, 10],
      model: '/models/car.glb',
      behaviors: [
        { type: 'movement', path: [[-5, 0, 10], [-5, 0, -10]], speed: 4, loop: true },
      ],
    },
  ],
};
```

---

## ä¸ƒã€å…±ç”¨ç³»çµ±

å¾ç¾æœ‰ `game/` è³‡æ–™å¤¾é‡ç”¨ï¼š

| ç³»çµ± | è·¯å¾‘ | ç”¨é€” |
|------|------|------|
| å‹•ç•«æ§åˆ¶ | `game/animations/AnimationController.ts` | æ’­æ”¾å±éšªå› å­å‹•ç•« |
| å‹•ç•«ç®¡ç† | `game/animations/AnimationManager.ts` | é è¼‰å…¥ã€å¿«å–å‹•ç•« |
| æ¨¡å‹è¼‰å…¥ | `game/models/ModelLoader.tsx` | è¼‰å…¥ 3D æ¨¡å‹ |
| ç’°å¢ƒç³»çµ± | `game/components/Environment.tsx` | å¤©ç©ºã€å…‰ç…§ã€åœ°é¢ |
| å…±ç”¨è¼‰å…¥å™¨ | `game/utils/SharedLoader.ts` | GLTF è¼‰å…¥å™¨ |

---

## å…«ã€App.tsx æ•´åˆ

```typescript
import { useState } from 'react';
import { MainMenu } from './components/MainMenu';
import { gameRegistry } from './games';

export default function App() {
  const [currentGame, setCurrentGame] = useState<string | null>(null);

  if (!currentGame) {
    return <MainMenu onSelectGame={setCurrentGame} />;
  }

  const game = gameRegistry.find(g => g.id === currentGame);
  if (!game) return null;

  const GameComponent = game.component;

  return <GameComponent onExit={() => setCurrentGame(null)} />;
}
```

---

## ä¹ã€æ–°å¢éŠæˆ²æµç¨‹

1. åœ¨ `games/` å»ºç«‹æ–°è³‡æ–™å¤¾
2. å¯¦ä½œéŠæˆ²ä¸»çµ„ä»¶ï¼ˆæ¥æ”¶ `onExit` propï¼‰
3. åœ¨ `games/index.ts` è¨»å†ŠéŠæˆ²
4. è‡ªå‹•å‡ºç¾åœ¨ä¸»é¸å–®
